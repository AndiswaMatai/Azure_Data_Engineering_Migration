# Azure Data Platform â€“ Fleet & Financial Reporting

## Business Context
Fragmented on-prem SQL Server systems slowed reporting. Executives needed faster insights into fleet utilization and financial performance.

## Architecture Overview
- Ingestion: Azure Data Factory
- Storage: Azure Data Lake Storage Gen2
- Transformation: Azure Databricks
- Analytics: Azure Synapse
- Visualization: Power BI

# Trigger Azure Data Factory pipeline
from azure.identity import DefaultAzureCredential
from azure.mgmt.datafactory import DataFactoryManagementClient

subscription_id = "<your-subscription-id>"
rg_name = "<your-resource-group>"
df_name = "<your-data-factory-name>"
pipeline_name = "FleetDataIngestion"

client = DataFactoryManagementClient(DefaultAzureCredential(), subscription_id)
run_response = client.pipelines.create_run(rg_name, df_name, pipeline_name)
print(f"Pipeline run ID: {run_response.run_id}")

# Databricks transformation: deduplicate fleet data
from pyspark.sql import SparkSession

spark = SparkSession.builder.getOrCreate()
df = spark.read.parquet("abfss://fleet@datalake.dfs.core.windows.net/raw/fleet_data")

deduped = df.dropDuplicates(["vehicle_id", "timestamp"])
deduped.write.mode("overwrite").parquet("abfss://fleet@datalake.dfs.core.windows.net/curated/fleet_data")

-- Synapse SQL: Fleet utilization by month
SELECT FORMAT(timestamp, 'yyyy-MM') AS Month,
       COUNT(DISTINCT vehicle_id) AS ActiveVehicles,
       SUM(CASE WHEN status = 'active' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) AS UtilizationRate
FROM curated.fleet_data
GROUP BY FORMAT(timestamp, 'yyyy-MM')
ORDER BY Month;

